View(ejr)
require(dplyr)
View(ejr)
ejr2<-ejr %>%
select(Journal,Result,First.Response) %>%
filter(Journal %in% c("American Economic Review",
"Quarterly Journal of Economics",
"Journal of Political Economy")) %>%
filter(Result %in% c("Ref Reject","Accepted"))
View(ejr2)
require(ggplot2)
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
theme_bw()
ggplot(ejr2,aes(x=First.Response,y=Journal)) +
geom_boxplot() +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
coord_flip() +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin() +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
?geom_violin
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin(fill="dark gray") +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
require(rvest)
require(magrittr)
require(dplyr)
require(ggplot2)
url<-"http://www.econjobrumors.com/journals.php"
ejr<-url %>%
html() %>%
html_table() %>%
extract(2) %>%
as.data.frame()
ejr2<-ejr %>%
select(Journal,Result,First.Response) %>%
filter(Journal %in% c("American Economic Review",
"Quarterly Journal of Economics",
"Journal of Political Economy")) %>%
filter(Result %in% c("Ref Reject","Accepted"))
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin(fill="dark gray") +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
table(ejr2$Journal)
6600
160*.3
6600/48
4721/48
# setwd("~/GitHub/corruption")
setwd("~/git/corruption")
#get cpi data from OKFN
cpi<-read.csv("http://data.okfn.org/data/core/corruption-perceptions-index/r/cpi.csv")
#reshape
require(reshape2)
cpim<-melt(cpi)
#get year
cpim$year<-as.numeric(substr(cpim$variable,2,5))
#rescale pre2012 to 0-100
cpim$value.rs<-ifelse(cpim$year<2012,cpim$value*10,cpim$value)
#create conditional color and alpha
cpim$col<-0
cpim$col[cpim$Jurisdiction=="Denmark"]<-1
cpim$col[cpim$Jurisdiction=="India"]<-0 #2 when India highlighted
cpim$alph<-0.9
cpim$alph[cpim$Jurisdiction=="Denmark"]<-1
cpim$alph[cpim$Jurisdiction=="India"]<-.9 #1 when India highlighted
library("ggplot2")
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("dark grey","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("black","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey30","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey30","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggsave("figures/cpitrends.pdf",width=9,height=5)
ggsave("figures/cpitrends.png",width=9,height=5,scale=1)
scan()
3
35
5
v<-scan()
mean(v)
hist(v)
require(readr)
require(dplyr)
require(stargazer)
dk94raw<-read_csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
View(dk94raw)
require(readr)
require(dplyr)
require(stargazer)
#get 98 and 2001 data
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk98raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-1998/ElectionStudy-1998_F1.csv")
dk01raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-2001/ElectionStudy-2001_F1.csv")
#recode data
dk94<-dk94raw %>%
transmute(immthreat=ifelse(v277<6,(v277-5)/-4,NA),
euredist=ifelse(v312<6,(v312-1)/4,NA),
euexp=ifelse(v316<6,(v316-1)/4,NA),
elec="1994")
dk98<-dk98raw %>%
transmute(immthreat=ifelse(v120<6,(v120-5)/-4,NA),
euredist=ifelse(v156<6,(v156-1)/4,NA),
euexp=ifelse(v160<6,(v160-1)/4,NA),
elec="1998")
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
View(dkm_9498)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(euredist~immthreat,data=dk94))
summary(lm(euredist~immthreat,data=dk98))
summary(lm(euredist~immthreat,data=dk01))
require(readr)
require(dplyr)
require(stargazer)
#get 98 and 2001 data
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk98raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-1998/ElectionStudy-1998_F1.csv")
dk01raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-2001/ElectionStudy-2001_F1.csv")
#check vars
table(dk98raw$v156)
#recode data
dk94<-dk94raw %>%
transmute(immthreat=ifelse(v277<6,(v277-5)/-4,NA),
euredist=ifelse(v312<6,(v312-1)/4,NA),
euexp=ifelse(v316<6,(v316-1)/4,NA),
eucurr=ifelse(v314<6,(v314-5)/-4,NA),
eugen=ifelse(v318<6,(v318-5)/-4,NA),
elec="1994")
dk98<-dk98raw %>%
transmute(immthreat=ifelse(v120<6,(v120-5)/-4,NA),
euredist=ifelse(v156<6,(v156-1)/4,NA),
euexp=ifelse(v160<6,(v160-1)/4,NA),
eucurr=NA,
eugen=NA,
elec="1998")
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
eucurr=NA,
eugen=ifelse(v318<6,(v318-5)/-4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
dkm_9401<-dk94 %>%
rbind(.,dk01)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
eucurr=NA,
eugen=ifelse(v172<6,(v172-5)/-4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
dkm_9401<-dk94 %>%
rbind(.,dk01)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
summary(lm(eugen~immthreat,data=dk94))
summary(lm(eugen~immthreat,data=dk01))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
require(haven)
se94raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0570 Swedish Election Study 1994/0570EU.dta")
se02raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0812 Swedish Election Study 2002/0812EU.dta")
se02raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0812 Swedish Election Study 2002/0812EV.dta")
str(se02raw)
str(se94raw)
str(se94raw)
str(se94raw)
str(se02raw)
1+1+5+2.5+1+2.5+1.5+2.5+1,5+1+5+5
1+1+5+2.5+1+2.5+1.5+2.5+1.5+1+5+5
1+1+5+2.5+1+2.5+1.5+2.5+1.5+1+5+5-1+9
install.packages("tufte")
load("https://github.com/antongrau/soc.elite/raw/master/data/den.rda")
load("C:/Users/fh/AppData/Local/Temp/den.rda")
View(den)
load("C:/Users/fh/AppData/Local/Temp/pe13.rda")
View(pe13)
load("C:/Users/fh/AppData/Local/Temp/directors08.rda")
View(directors08)
View(den)
require(dplyr)
require(magrittr)
?runif
n<-250
simdat<-data.frame(disttometro=runif(n,0,300))
View(simdat)
simdat<-data.frame(disttometro=runif(n,0,300),metrocomp=0)
View(simdat)
n<-250
simdat<-data.frame(disttometro=runif(n,0,300),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,1500,metrocomp))
View(simdat)
n<-250
simdat<-data.frame(disttometro=runif(n,0,300),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,1500,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,1000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,500,metrocomp))
View(simdat)
### define variables
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,1500,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,1000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,500,metrocomp))
View(simdat)
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,4000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,3000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,1000,metrocomp))
View(simdat)
?rnorm
### define variables
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,4000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,3000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,1000,metrocomp)) %>%
mutate(ownincome=rnorm(n,20000,5000))
View(simdat)
### define variables
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,4000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,3000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,1000,metrocomp)) %>%
mutate(ownincome=rnorm(n,20000,5000)) %>%
mutate(incomeboost=100*(metrocomp/ownincome))
View(simdat)
View(simdat)
hist(simdat$incomeboost)
### define variables
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,4000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,3000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,1000,metrocomp)) %>%
mutate(ownincome=rnorm(n,20000,5000)) %>%
mutate(incomeboost=100*(metrocomp/ownincome),
noise=60-disttometro*.3)
View(simdat)
### define variables
n<-250
simdat<-data.frame(disttometro=runif(n,0,350),metrocomp=0) %>%
mutate(metrocomp=ifelse(disttometro <= 50,4000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 100 & disttometro > 50,3000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 150 & disttometro > 100,2000,metrocomp)) %>%
mutate(metrocomp=ifelse(disttometro <= 200 & disttometro > 150,1000,metrocomp)) %>%
mutate(ownincome=rnorm(n,20000,5000)) %>%
mutate(incomeboost=100*(metrocomp/ownincome),
noise=ifelse(disttometro <= 120,60-disttometro*.2,0))
View(simdat)
require(lubridate)
require(dplyr)
require(magrittr)
require(ggplot2)
require(reshape2)
require(stargazer)
require(readr)
require(tidyr)
require(broom)
require(lme4)
require(arm)
#win
#setwd("C:/Users/fh/Documents/GitHub/parlbias/data")
#mac
setwd("~/GitHub/parlbias/data")
ftall<-readRDS("ftall.rds")
#remove very short and very long speeches
ft<-subset(ftall,secs<150 & secs>10 & year(starttime)>2000)
ft<-arrange(ft,starttime)
# #check sample of data
# sample_n(ft,30)
# ggplot(subset(ft,chair==0),aes(x=secs)) + geom_density()
# ggplot(ft,aes(x=timeofday,y=secs)) + geom_point() + facet_grid(debate~.)
View(ft)
View(ft)
View(ft)
dmy(ft$starttime[5])
View(ft)
dmy(substr(ft$starttime[5],1,10))
substr(ft$starttime[5],1,10)
ymd(substr(ft$starttime[5],1,10))
ymd(ft$starttime[5])
ymd(substr(ft$starttime[5],1,10))
ymd(substr(ft$starttime[5],1,10))=="2010-10-07"
ymd(substr(ft$starttime[5],1,10))=="2010-10-07 UTC"
ymd(substr(ft$starttime[5],1,10))==ymd("2010-10-07")
View(ft)
seq(ymd("2011-09-15"),ymd("2011-09-20"))
seq(ymd("2011-09-15"),ymd("2011-09-20"),by="days")
ymd("2011-09-18") %in% seq(ymd("2011-09-15"),ymd("2011-09-20"),by="days")
ymd("2011-09-18") %in% seq(ymd("2011-09-15"),ymd("2011-10-20"),by="weeks")
ft$pm[ft$fullname=="Helle Thorning-Schmidt" & ymd(substr(ft$starttime,1,10)) %in% seq(ymd("2011-09-15"),ymd("2011-09-15"),by="days")]
ft$pm[ft$fullname=="Helle Thorning-Schmidt" & ymd(substr(ft$starttime,1,10)) %in% seq(ymd("2011-09-15"),ymd("2015-06-18"),by="days")]
ft$pm[ft$fullname=="Helle Thorning-Schmidt" & ymd(substr(ft$starttime,1,10)) %in% seq(ymd("2011-09-15"),ymd("2015-06-18"),by="days")]<-1
ft$pm[ft$fullname=="Lars Loekke Rasmussen" & ymd(substr(ft$starttime,1,10)) > ymd("2015-06-18")]
ft$pm[ft$fullname=="Lars Loekke Rasmussen" & ymd(substr(ft$starttime,1,10)) > ymd("2015-06-18")]<-1
require(lubridate)
require(dplyr)
require(magrittr)
require(ggplot2)
require(reshape2)
require(stargazer)
require(readr)
require(zoo)
#win
#setwd("C:/Users/fh/Documents/GitHub/parlbias/data")
#mac
setwd("~/GitHub/parlbias/data")
#read in data
ft<-rbind(readRDS(file="ft10to13.rds"),readRDS(file="ft14to15.rds"))
#clean up data a bit
#assign PM's to parties
table(ft$party)
ft$party[substr(as.character(ft$party),1,22)=="Helle Thorning-Schmidt"]<-"S"
ft$party[substr(as.character(ft$fullname),1,22)=="Helle Thorning-Schmidt"]<-"S"
ft$party[ft$party=="Lars Loekke Rasmussen"]<-"V"
ft$party[ft$fullname=="Lars Loekke Rasmussen"]<-"V"
ft$party<-as.character(ft$party)
table(ft$party)
#measure of seconds
ft$secs<-as.numeric(difftime(ft$endtime,ft$starttime))
#does speaking time exceed the limit?
ft$secsgt60<-ifelse(ft$secs>60,1,0)
#remove breaks
ft<-ft[-which(is.na(ft$party) & ft$secs>300),]
#code the party and name of the presiding chairman
ft$chairparty<-ifelse(ft$chair==1,as.character(ft$party),NA)
ft$chairname<-ifelse(ft$chair==1,as.character(ft$fullname),NA)
#fill in empty slots
ft$chairparty<-na.locf(ft$chairparty)
ft$chairname<-na.locf(ft$chairname)
#variable for whether the speaker is ingroup wrt the chairman
ft$copartisan<-ifelse(as.character(ft$party)==ft$chairparty,1,0)
ft$copartisan<-ifelse(ft$chair==1,NA,ft$copartisan)
# #cutpoint of 150 secs very effectively weeds out spokesperson speeches
# require(ggplot2)
# ggplot(ft,aes(x=secs)) +
#   geom_density() +
#   geom_vline(xintercept=150) +
#   theme_bw()
#get time of day
ft$timeofday<-hour(ft$starttime)+minute(ft$starttime)/60+second(ft$starttime)/3600
ft$timeofday<-ifelse(ft$timeofday<8,ft$timeofday+24,ft$timeofday)
summary(ft$timeofday)
#speech length by time of day
ggplot(ft,aes(x=timeofday,y=secs)) +
geom_point(alpha=.2) +
geom_smooth() +
theme_bw()
#dummy for whether speaker party is in parl. leadership ("pr?sidiet")
ft$leadshipparty<-ifelse(ft$party %in% names(table(ft$chairparty)),1,0)
table(ft$party[ft$leadshipparty==1])
#create simpler party variable
ft$coarseparty<-ifelse(ft$party %in% c("IA","JF","SIU","SP","T","TF","KD","UFG"),"Other",ft$party)
#fix prime minister names
pmfullnames<-as.character(names(table(droplevels(ft$fullname[ft$pm==1]))))
ft$fullname[ft$fullname==pmfullnames[1]]<-"Helle Thorning-Schmidt"
ft$fullname[ft$fullname==pmfullnames[2]]<-"Lars Loekke Rasmussen"
ft$fullname[ft$fullname==pmfullnames[3]]<-"Helle Thorning-Schmidt"
#is the pm speaking?
subset(ft,substr(ft$fullname,1,nchar("Statsministeren"))=="Statsministeren")
ft$pm<-ifelse(substr(ft$fullname,1,nchar("Statsministeren"))=="Statsministeren",1,0)
#fix pm assignments after 2014
ft$pm[ft$fullname=="Helle Thorning-Schmidt" & ymd(substr(ft$starttime,1,10)) %in% seq(ymd("2011-09-15"),ymd("2015-06-18"),by="days")]<-1
ft$pm[ft$fullname=="Lars Loekke Rasmussen" & ymd(substr(ft$starttime,1,10)) > ymd("2015-06-18")]<-1
#get parties placements from voter estimates in most recent election survey
FV11<-read.csv("../rawdata/ElectionStudy-2011_F1.csv",sep=",",dec=".")
FV11<-FV11 %>%
select(num_range("v",228:235)) %>%
melt() %>%
filter(value<11) %>%
group_by(variable) %>%
summarise(intpos=mean(value)) %>%
mutate(ordpos=rank(intpos),party=c("S","RV","KF","SF","LA","DF","V","EL")) %>%
arrange(ordpos) %>%
select(intpos:party)
#assign interval and ordinal positions to speakers and chairmen
ft$spkrintpos<-NA
ft$chairintpos<-NA
ft$spkrordpos<-NA
ft$chairordpos<-NA
for(i in 1:nrow(ft)){
if(ft$party[i] %in% FV11$party){
ft$spkrintpos[i]<-subset(FV11,party==ft$party[i])$intpos
ft$spkrordpos[i]<-subset(FV11,party==ft$party[i])$ordpos
}
if(ft$chairparty[i] %in% FV11$party){
ft$chairintpos[i]<-subset(FV11,party==ft$chairparty[i])$intpos
ft$chairordpos[i]<-subset(FV11,party==ft$chairparty[i])$ordpos
}
}
#calculate political distance measure, based on voter placements in FV11
ft$intposdif<-ifelse(ft$chair==0,abs(ft$spkrintpos-ft$chairintpos),NA)
ft$ordposdif<-ifelse(ft$chair==0,abs(ft$spkrordpos-ft$chairordpos),NA)
#bloc variable
table(ft$party)
table(ft$chairparty)
ft$leftspkr<-ifelse(ft$party=="S" | ft$party=="RV" | ft$party=="SF" | ft$party=="EL",1,0)
ft$leftchair<-ifelse(ft$chairparty=="S"| ft$chairparty=="SF" | ft$chairparty=="RV",1,0)
ft$cobloc<-abs(abs(ft$leftspkr-ft$leftchair)-1)
ft$cobloc[ft$chair==1]<-NA
#factor for debate type
ft$debatetype<-"Closing"
ft$debatetype[month(ft$starttime)==10]<-"Opening"
#factor for specific debate
names(ft)
ft<-ft %>%
mutate(debate=paste(debatetype,year(starttime),sep=" "))
table(ft$debate)
#three odd time stamps (all chairmen, so no effect on results)
subset(ft,debate=="Closing 1900")
#read in background data on politicians
require(XML)
pols<-xmlParse("http://hvemstemmerhvad.dk/api/api_politikere.php")
pols<-xmlToDataFrame(pols)[1:491,]
pols$fullname<-as.character(pols$fulde_navn,Encoding="UTF-8")
pols$fullname<-gsub("æ","ae",pols$fullname)
pols$fullname<-gsub("ø","oe",pols$fullname)
pols$fullname<-gsub("å","aa",pols$fullname)
pols$fullname<-gsub("Æ","Ae",pols$fullname)
pols$fullname<-gsub("Ø","Oe",pols$fullname)
pols$fullname<-gsub("Å","Aa",pols$fullname)
#add in gender variable
pols$female<-as.numeric(read.table("../rawdata/polsgenders.txt")$V1)
pols<-select(pols,fullname,female)
polsgenders<-data.frame(fullname=unique(ft$fullname)) %>%
left_join(.,pols,by="fullname")
# #export the gender data frame so I can edit it manually
# write_csv(polsgenders,"../rawdata/polsgenders2.csv")
#read back in edited polsgenders
polsgenders2<-read_csv("../rawdata/polsgenders2.csv")
#merge in
ft<-left_join(ft,polsgenders2,by="fullname")
# #calculate age in years at time of speaking
# ft$speakerage<-(year(ft$starttime)+month(ft$starttime)/12)-(year(ymd(ft$birthday))+month(ymd(ft$birthday))/12)
#save version for easy reload
ftall<-ft
saveRDS(ftall,"ftall.rds")
write_csv(ftall,"ftall.csv")
