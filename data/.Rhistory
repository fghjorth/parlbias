summary((((simdat$hinc-300)^2)/35000)^.3)
#recover true model
summary(truemodel<-lm(attitude~polint+hinc,data=simdat))
#now, let low income households have more missingness
summary(simdat$hinc)
simdat$missingprob<-(((simdat$hinc-300)^2)/35000)^.3
simdat$hinc_nas<-NA
for (i in 1:1000){
simdat$hinc_nas[i]<-ifelse(median(rbinom(10,1,simdat$missingprob[i]))==1,NA,simdat$hinc[i])
}
plot(simdat$hinc,is.na(simdat$hinc_nas))
#data frame for storing estimates
allests<-data.frame(tru_coef=rep(NA,200),tru_se=NA,lwd_coef=NA,lwd_se=NA,ran_coef=NA,ran_se=NA,all_coef=NA,all_se=NA)
for (j in 1:200){
#sim data
set.seed(100+j)
error1<-rnorm(1000,0,5)
error2<-rnorm(1000,0,5)
hinc<-rnorm(1000,300,sd=50)
polint<-rnorm(1000,10,sd=5)+20*error1+.5*hinc
attitude<- -40+.2*hinc+.6*polint+20*error2
simdat<-data.frame(attitude,polint,hinc)
#recover true model
summary(truemodel<-lm(attitude~polint+hinc,data=simdat))
#now, let low income households have more missingness
summary(simdat$hinc)
simdat$missingprob<-(((simdat$hinc-300)^2)/35000)^.3
simdat$hinc_nas<-NA
for (i in 1:1000){
simdat$hinc_nas[i]<-ifelse(median(rbinom(10,1,simdat$missingprob[i]))==1,NA,simdat$hinc[i])
}
plot(simdat$hinc,is.na(simdat$hinc_nas))
#how does that affect the result?
summary(listwise<-lm(attitude~polint+hinc_nas,data=simdat))
#run multiple imputation
require(Amelia)
names(simdat)
m<-10
a.out<-amelia(simdat[,c(1,2,5)],m=m,p2s=0)
#rerun model on first data set
simdat_mi1<-a.out$imputations[[1]]
summary(randomimp<-lm(attitude~polint+hinc_nas,data=simdat_mi1))
#run mi.meld to get correct standard errors
b.out<-NULL
se.out<-NULL
for(i in 1:m) {
ols.out <- lm(attitude~polint+hinc_nas,data=a.out$imputations[[i]])
b.out <- rbind(b.out, ols.out$coef)
se.out <- rbind(se.out, coef(summary(ols.out))[,2])
}
b.out
combined.results <- mi.meld(q = b.out, se = se.out)
#new model object with combined results - we'll plug them in in stargazer
allimps<-randomimp
# #show in regression table
# require(stargazer)
# stargazer(truemodel,listwise,randomimp,allimps,style="apsr",type="text",
#           coef=list(NULL,NULL,NULL,combined.results$q.mi),se=list(NULL,NULL,NULL,combined.results$se.mi),
#           column.labels=c("true model","listwise deletion","random imputation","combined imputations"))
allests[j,1:2]<-summary(truemodel)$coefficients[3,1:2]
allests[j,3:4]<-summary(listwise)$coefficients[3,1:2]
allests[j,5:6]<-summary(randomimp)$coefficients[3,1:2]
allests[j,7:8]<-c(combined.results$q.mi[3],combined.results$se.mi[3])
}
#melt
require(reshape2)
allestsm<-melt(allests)
#plot
require(ggplot2)
ggplot(allestsm,aes(x=variable,y=value)) +
geom_boxplot() +
facet_grid()
#plot
require(ggplot2)
ggplot(allestsm,aes(x=variable,y=value)) +
geom_boxplot()
library("devtools")
install_github("rOpenGov/dkstat")
library(dkstat)
dst_meta(table="BEF3",lang="en")
bef3<-dst_meta(table="BEF3",lang="en")
str(bef3)
names(bef3$values)
table(bef3$values$HERKOMST)
table(bef3$values$IELAND)
names(bef3$values)
str(bef3)
dst_get_data(table="bef3",OMRÅDE="All Denmark",Tid="1980")
names(bef3$values)
dst_get_data(table="bef3",
OMRÅDE="All Denmark",
ALDER="0 year",
KØN="Men",
HERKOMST="Persons of Danish Origin",
STATSB="Denmark",
IELAND="Denmark",
Tid="1980")
?dst_get_data
dst_get_data(table="bef3",
OMRÅDE="All Denmark",
ALDER="0 year",
KØN="Men",
HERKOMST="Persons of Danish Origin",
STATSB="Denmark",
IELAND="Denmark",
Tid="1980",
lang="en")
dst_get_data(table="bef3",
OMRÅDE="All Denmark",
ALDER="0 year",
KØN="Men",
HERKOMST="Persons of Danish Origin",
STATSB="Denmark",
IELAND="Denmark",
Tid="1980",
lang="en",
meta=bef3)
names(bef3$values)
dst_get_data(table="bef3",
OMRÅDE="All Denmark",
ALDER="0 year",
KØN="Men",
HERKOMST="Persons of Danish Origin",
STATSB="Denmark",
IELAND="Denmark",
Tid="1980",
lang="da",
meta=bef3)
bef3<-dst_meta(table="BEF3",lang="da")
str(bef3)
names(bef3$values)
dst_get_data(table="bef3",
OMRÅDE="Hele landet",
ALDER="0 år",
KØN="Mænd",
HERKOMST="Personer med dansk oprindelse",
STATSB="Dansk",
IELAND="Danmark",
Tid="1980",
lang="da",
meta=bef3)
dst_get_data(table="bef3",
OMRÅDE="Hele landet",
ALDER="0 år",
KØN="Mænd",
HERKOMST="Personer med dansk oprindelse",
STATSB="Dansk",
IELAND="Danmark",
TID="1980",
lang="da",
meta=bef3)
names(bef3$values)
#test
testquery<-list(OMRÅDE="Hele landet",
ALDER="0 år",
KØN="Mænd",
HERKOMST="Personer med dansk oprindelse",
STATSB="Dansk",
IELAND="Danmark",
TID="1980")
names(testquery)
toupper(names(bef3$values))
dst_get_data(table="bef3",
query=testquery,
lang="da",
meta=bef3)
folk1_meta <- dst_meta("folk1", lang = "da")
#test github readme example
folk1_meta <- dst_meta("folk1", lang = "da")
my_query <- list(OMRÅDE = c("Hele landet", "København", "Frederiksberg", "Odense"),
STATSB = "Danmark",
TID = "*")
dst_get_data(table = "folk1", query = my_query, lang = "da")
str(dst_get_data(table = "folk1", query = my_query, lang = "da"))
comat<-matrix(c(0,0,1,0,0,0,0,0,0,0,0,1,0,0),ncol=7,nrow=2,byrow=T)
comat
require(irr)
kripp.alpha(comat,method="nominal")
top<-4/14
bottom<-2/11
krip<- 1- (top/bottom)
top<-2/14
krip<- 1- (top/bottom)
1-(13/12)
install.packages("ineq")
require(ineq)
??gini
Gini(c(100,100,100,110))
Gini(c(100,1000))
Gini(c(250,2000))
require(rvest)
ejr<-read_html("http://www.econjobrumors.com/journals.php")
??rvest
url<-"http://www.econjobrumors.com/journals.php"
require(magrittr)
ejr<-url %>%
html()
ejr<-url %>%
html() %>%
html_table()
str(ejr)
ejr<-url %>%
html() %>%
html_table() %>%
extract(2)
str(ejr)
str(unlist(ejr))
ejr<-url %>%
html() %>%
html_table() %>%
extract(2) %>%
as.data.frame()
View(ejr)
require(dplyr)
View(ejr)
ejr2<-ejr %>%
select(Journal,Result,First.Response) %>%
filter(Journal %in% c("American Economic Review",
"Quarterly Journal of Economics",
"Journal of Political Economy")) %>%
filter(Result %in% c("Ref Reject","Accepted"))
View(ejr2)
require(ggplot2)
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
theme_bw()
ggplot(ejr2,aes(x=First.Response,y=Journal)) +
geom_boxplot() +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
coord_flip() +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_boxplot() +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin() +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
?geom_violin
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin(fill="dark gray") +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
require(rvest)
require(magrittr)
require(dplyr)
require(ggplot2)
url<-"http://www.econjobrumors.com/journals.php"
ejr<-url %>%
html() %>%
html_table() %>%
extract(2) %>%
as.data.frame()
ejr2<-ejr %>%
select(Journal,Result,First.Response) %>%
filter(Journal %in% c("American Economic Review",
"Quarterly Journal of Economics",
"Journal of Political Economy")) %>%
filter(Result %in% c("Ref Reject","Accepted"))
ggplot(ejr2,aes(x=Journal,y=First.Response)) +
geom_violin(fill="dark gray") +
coord_flip() +
labs(x="",y="Months to first response") +
theme_bw()
table(ejr2$Journal)
6600
160*.3
6600/48
4721/48
# setwd("~/GitHub/corruption")
setwd("~/git/corruption")
#get cpi data from OKFN
cpi<-read.csv("http://data.okfn.org/data/core/corruption-perceptions-index/r/cpi.csv")
#reshape
require(reshape2)
cpim<-melt(cpi)
#get year
cpim$year<-as.numeric(substr(cpim$variable,2,5))
#rescale pre2012 to 0-100
cpim$value.rs<-ifelse(cpim$year<2012,cpim$value*10,cpim$value)
#create conditional color and alpha
cpim$col<-0
cpim$col[cpim$Jurisdiction=="Denmark"]<-1
cpim$col[cpim$Jurisdiction=="India"]<-0 #2 when India highlighted
cpim$alph<-0.9
cpim$alph[cpim$Jurisdiction=="Denmark"]<-1
cpim$alph[cpim$Jurisdiction=="India"]<-.9 #1 when India highlighted
library("ggplot2")
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("dark grey","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("black","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
#plot!
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey30","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggplot(cpim,aes(x=year,y=value.rs,group=Jurisdiction)) +
geom_line(aes(color=factor(col),alpha=alph),size=1) +
scale_color_manual(values=c("grey30","firebrick","forestgreen")) +
theme_minimal() +
labs(x="",y="Corruption Perceptions Index") +
theme(legend.position="none") +
#  annotate("text",x=2007,y=38,label="India",color="forestgreen",size=4) +
annotate("text",x=2008,y=97,label="Denmark",color="firebrick",size=4)
ggsave("figures/cpitrends.pdf",width=9,height=5)
ggsave("figures/cpitrends.png",width=9,height=5,scale=1)
scan()
3
35
5
v<-scan()
mean(v)
hist(v)
require(readr)
require(dplyr)
require(stargazer)
dk94raw<-read_csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
View(dk94raw)
require(readr)
require(dplyr)
require(stargazer)
#get 98 and 2001 data
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk98raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-1998/ElectionStudy-1998_F1.csv")
dk01raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-2001/ElectionStudy-2001_F1.csv")
#recode data
dk94<-dk94raw %>%
transmute(immthreat=ifelse(v277<6,(v277-5)/-4,NA),
euredist=ifelse(v312<6,(v312-1)/4,NA),
euexp=ifelse(v316<6,(v316-1)/4,NA),
elec="1994")
dk98<-dk98raw %>%
transmute(immthreat=ifelse(v120<6,(v120-5)/-4,NA),
euredist=ifelse(v156<6,(v156-1)/4,NA),
euexp=ifelse(v160<6,(v160-1)/4,NA),
elec="1998")
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
View(dkm_9498)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(euredist~immthreat,data=dk94))
summary(lm(euredist~immthreat,data=dk98))
summary(lm(euredist~immthreat,data=dk01))
require(readr)
require(dplyr)
require(stargazer)
#get 98 and 2001 data
dk94raw<-read_csv(file="C:/Users/fh/Dropbox/Data/ElectionStudy-1994/ElectionStudy-1994_F1.csv")
dk98raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-1998/ElectionStudy-1998_F1.csv")
dk01raw<-read_csv("C:/Users/fh/Dropbox/Data/ElectionStudy-2001/ElectionStudy-2001_F1.csv")
#check vars
table(dk98raw$v156)
#recode data
dk94<-dk94raw %>%
transmute(immthreat=ifelse(v277<6,(v277-5)/-4,NA),
euredist=ifelse(v312<6,(v312-1)/4,NA),
euexp=ifelse(v316<6,(v316-1)/4,NA),
eucurr=ifelse(v314<6,(v314-5)/-4,NA),
eugen=ifelse(v318<6,(v318-5)/-4,NA),
elec="1994")
dk98<-dk98raw %>%
transmute(immthreat=ifelse(v120<6,(v120-5)/-4,NA),
euredist=ifelse(v156<6,(v156-1)/4,NA),
euexp=ifelse(v160<6,(v160-1)/4,NA),
eucurr=NA,
eugen=NA,
elec="1998")
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
eucurr=NA,
eugen=ifelse(v318<6,(v318-5)/-4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
dkm_9401<-dk94 %>%
rbind(.,dk01)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
dk01<-dk01raw %>%
transmute(immthreat=ifelse(v122<6,(v122-5)/-4,NA),
euredist=ifelse(v166<6,(v166-1)/4,NA),
euexp=ifelse(v169<6,(v169-1)/4,NA),
eucurr=NA,
eugen=ifelse(v172<6,(v172-5)/-4,NA),
elec="2001")
dkm_9498<-dk94 %>%
rbind(.,dk98)
dkm_9401<-dk94 %>%
rbind(.,dk01)
summary(lm(euredist~elec*immthreat,data=dkm_9498))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
summary(lm(eugen~immthreat,data=dk94))
summary(lm(eugen~immthreat,data=dk01))
summary(lm(eugen~elec*immthreat,data=dkm_9401))
require(haven)
se94raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0570 Swedish Election Study 1994/0570EU.dta")
se02raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0812 Swedish Election Study 2002/0812EU.dta")
se02raw<-read_dta("C:/Users/fh/Dropbox/Data/SND 0812 Swedish Election Study 2002/0812EV.dta")
str(se02raw)
str(se94raw)
str(se94raw)
str(se94raw)
str(se02raw)
1+1+5+2.5+1+2.5+1.5+2.5+1,5+1+5+5
1+1+5+2.5+1+2.5+1.5+2.5+1.5+1+5+5
1+1+5+2.5+1+2.5+1.5+2.5+1.5+1+5+5-1+9
require(lubridate)
require(dplyr)
require(magrittr)
require(ggplot2)
require(reshape2)
require(stargazer)
require(readr)
require(tidyr)
require(broom)
require(lme4)
require(arm)
#win
#setwd("C:/Users/fh/Documents/GitHub/parlbias/data")
#mac
setwd("~/GitHub/parlbias/data")
ftall<-readRDS("ftall.rds")
#remove very short and very long speeches
ft<-subset(ftall,secs<150 & secs>10 & year(starttime)>2000)
ft<-arrange(ft,starttime)
#check sample of data
sample_n(ft,30)
ggplot(subset(ft,chair==0),aes(x=secs)) + geom_density()
ggplot(ft,aes(x=timeofday,y=secs)) + geom_point() + facet_grid(debate~.)
#get list of chairmen by debate
allchairmen<-ftall %>%
filter(chair==1) %>%
group_by(chairname,debate) %>%
summarise(remarks=length(chairname))
seatvec<-c(16,rep(22,2),rep(47,7),rep(8,3),rep(18,2),47,23,16,23,16,9,47,44,34,17,17,13,45,rep(47,3),45,rep(47,4),rep(22,4),37,25,22,25,22,16,14,rep(46,2)) #careful! here I manually type in the seats for each chairman's party by debate
allchairmen$seats<-seatvec
allchairmen<-allchairmen %>%
group_by(chairname) %>%
summarise(remarks=sum(remarks),debates=length(debate),avgseats=mean(seats)) %>%
mutate(president=ifelse(chairname %in% c("Thor Pedersen","Mogens Lykketoft","Pia Kjaersgaard"),1,0))
#can we predict chairman activity?
summary(remarksm1<-lm(remarks~debates+president,data=allchairmen))
summary(remarksm2<-lm(remarks~debates+president+avgseats,data=allchairmen))
summary(remarksm3<-lm(remarks~avgseats,data=allchairmen))
summary(remarksm3<-lm(remarks~avgseats+president,data=allchairmen))
#can we predict chairman activity?
summary(remarksm1<-lm(remarks~president+debates,data=allchairmen))
summary(remarksm2<-lm(remarks~president+debates+avgseats,data=allchairmen))
summary(remarksm3<-lm(remarks~president+avgseats,data=allchairmen))
remarksregtab<-stargazer(remarksm1,remarksm2,remarksm3,style="apsr",omit.stat=c("wald"),
dep.var.labels="Number of remarks enforced",dep.var.labels.include=T,font.size="footnotesize",
label="parlbias_remarksregtab",column.sep.width="-5pt",star.cutoffs=c(.1,.05,.01),
align=T,title="Model predicting number of remarks enforced by chairmen",digits=2)
remarksregtab<-stargazer(remarksm1,remarksm2,remarksm3,style="apsr",omit.stat=c("wald"),
dep.var.labels="Number of remarks enforced",dep.var.labels.include=T,font.size="footnotesize",
label="parlbias_remarksregtab",column.sep.width="-5pt",star.cutoffs=c(.1,.05,.01),
align=T,title="Model predicting number of remarks enforced by chairmen",digits=2,
covariate.labels=c("Head chairman","No. of party seats","No. of debates in leadership"))
#table for reg predicting remarks presided over
remarksregtab<-stargazer(remarksm1,remarksm2,remarksm3,style="apsr",omit.stat=c("wald"),
dep.var.labels="Number of remarks enforced",dep.var.labels.include=T,font.size="footnotesize",
label="parlbias_remarksregtab",column.sep.width="-5pt",star.cutoffs=c(.1,.05,.01),
align=T,title="Model predicting number of remarks enforced by chairmen",digits=2,
covariate.labels=c("Head chairman","No. of debates in leadership","No. of party seats"))
#table for reg predicting remarks presided over
remarksregtab<-stargazer(remarksm1,remarksm2,remarksm3,style="apsr",omit.stat=c("wald"),
dep.var.labels="Number of remarks enforced",dep.var.labels.include=T,font.size="footnotesize",
label="parlbias_remarksregtab",column.sep.width="-5pt",star.cutoffs=c(.1,.05,.01),
align=T,title="Model predicting number of remarks enforced by chairmen",digits=2,
covariate.labels=c("Head chairman","No. of debates in leadership","No. of party seats"))
writeLines(remarksregtab,con="../tables/parlbias_remarksregtab.txt")
